---
import "../styles/main.scss";
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{Astro.slots.has('title') ? Astro.slots.render('title') : 'Cody Tanksley'}</title>
    <meta
      name="description"
      content="Software engineer, photographer, and writer from Albany, NY"
    />
    <meta name="color-scheme" content="light dark" />
    <script>
      // Apply session theme or fallback to system preference before CSS loads
      (function () {
        var KEY = 'theme-mode';
        var prefersDark = false;
        try {
          prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        } catch (_err) {
          prefersDark = false;
        }

        var mode = prefersDark ? 'dark' : 'light';
        try {
          var stored = sessionStorage.getItem(KEY);
          if (stored === 'light' || stored === 'dark') {
            mode = stored;
          } else {
            sessionStorage.setItem(KEY, mode);
          }
        } catch (_e) {
          // ignore sessionStorage failures
        }

        document.documentElement.setAttribute('data-theme', mode);
      })();
    </script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css"
    />
  </head>

  <body>
    <header>
      <nav>
        <a href="/" class="site-title">Cody Tanksley</a>
        <div class="nav-links">
          <a href="/about">About</a>
          <button
            id="theme-toggle"
            data-theme-toggle
            class="theme-toggle"
            type="button"
            data-mode="dark"
            aria-label="Switch to dark mode"
          >
            <span class="theme-icon theme-icon--sun" aria-hidden="true">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-sun-icon lucide-sun"
                focusable="false"
              >
                <circle cx="12" cy="12" r="4" />
                <path d="M12 2v2" />
                <path d="M12 20v2" />
                <path d="m4.93 4.93 1.41 1.41" />
                <path d="m17.66 17.66 1.41 1.41" />
                <path d="M2 12h2" />
                <path d="M20 12h2" />
                <path d="m6.34 17.66-1.41 1.41" />
                <path d="m19.07 4.93-1.41 1.41" />
              </svg>
            </span>
            <span class="theme-icon theme-icon--moon" aria-hidden="true">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-moon-icon lucide-moon"
                focusable="false"
              >
                <path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401" />
              </svg>
            </span>
          </button>
        </div>
      </nav>
    </header>

    <main>
      <slot />
    </main>

    <footer>
      <p>Cody Tanksley</p>
    </footer>
    <script>
      import "../scripts/theme-toggle.ts";
      import "../scripts/equations.ts";
    </script>
  </body>
</html>
